        .character-tile {
            aspect-ratio: 1 / 1; /* Make tiles square */
            width: 160px;
            border: 3px solid #9400D3; /* Dark Violet */
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column; /* Stack content vertically */
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 10px;
            box-sizing: border-box;
        }

        .character-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #DA70D6; /* Orchid glow */
        }

        .character-tile.locked {
            filter: grayscale(1) brightness(0.6);
            cursor: not-allowed;
            border-color: #555;
        }
         .character-tile.selected {
            border-color: #FFD700; /* Gold to show selection */
            box-shadow: 0 0 20px #FFD700;
        }

        .upgrade-card.selected {
        border: 4px solid #FFD700; /* Gold to show selection */
        box-shadow: 0 0 20px #FFD700;
        transform: scale(1.05);
        }
        .character-tile .char-emoji {
            font-size: 48px;
            margin: 0;
        }
        
        .character-tile .char-name {
            font-family: 'Press Start 2P', cursive;
            color: white;
            font-size: 14px;
            text-shadow: 2px 2px 4px black;
            margin: 8px 0;
        }

        .character-tile .char-perk {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            color: #ccc;
            margin: 0;
        }

        .character-tile.locked .char-perk {
            color: #F44336; /* Red text for LOCKED */
            font-weight: bold;
        }
        body {
    display: flex;
    flex-direction: column;
    justify-content: center; /* CHANGED from flex-start to center */
    align-items: center;
    min-height: 100vh; /* CHANGED from 10vh to 100vh */
    margin: 0;
    background-color: #1a1a1a;
    color: #e0e0e0;
    font-family: 'Inter', sans-serif;
    text-align: center;
    padding: 0;
    box-sizing: border-box;
    -webkit-user-select: none;
    user-select: none;
    touch-action: none;
    overflow: hidden;
}

        #gameContainer {
            position: relative;
            line-height: 0; 
        }

       canvas {
    background-color: #000000;
    border: 2px solid #66bb6a;
    width: clamp(320px, 95vw, 1125px);
    height: auto;
    max-width: 1125px;
    max-height: 95vh; /* CHANGED THIS LINE */
    aspect-ratio: auto;
    box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
    border-radius: 10px;
    object-fit: contain;
    display: block; 
}
        .thumbstick-base {
            position: fixed;
            width: 102px;
            height: 102px;
            background-color: rgba(74, 74, 74, 0.5);
            border: 2px solid #66bb6a;
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            touch-action: manipulation;
            opacity: 0.35;
            pointer-events: all;
        }
        body.is-mobile .thumbstick-base {
            display: flex;
        }

        #movement-stick-base {
            bottom: 140px;
            left: 68px;
        }
        #fire-stick-base {
            bottom: 140px;
            right: 68px;
        }
        .thumbstick-cap {
            width: 52px;
            height: 52px;
            background-color: rgba(102, 187, 106, 0.8);
            border: 2px solid #ffffff;
            border-radius: 50%;
            transition: transform 0.1s ease-out;
            opacity: 0.35;
        }
        
        #gameStats {
            display: none; /* Hide by default, shown via JS */
            position: absolute;
            top: 10px;
            right: 10px;
            background: url('sprites/uibackground.png') no-repeat center center;
            background-size: 100% 100%;
            opacity: 0.5;
            padding: 15px 20px;
            color: #000000;
            font-size: 8px;
            text-align: right;
            z-index: 10;
            font-family: 'Press Start 2P', cursive;
            border-radius: 0;
            border: none;
            box-shadow: none;
        }
        #gameStats p {
            margin: 2px 0;
            line-height: 1.4;
        }
        
        #powerupIcons {
            margin-top: 5px;
            display: flex;
            justify-content: flex-end;
            flex-wrap: wrap;
            gap: 4px;
            max-width: 150px; 
            margin-left: auto; 
        }
        
        #powerupIcons span {
            font-size: 14px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            padding: 2px;
            transition: font-size: 0.2s; 
        }
        
        #powerupIcons.small-icons span {
            font-size: 10px;
            gap: 2px;
        }

        
        #upgradeStats {
            margin-top: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.2);
            padding-top: 4px;
        }
        #upgradeStats p {
            font-size: 6px;
            margin: 1px 0;
            letter-spacing: 1px; /* Tally mark spacing */
        }


        @keyframes text-pop-glow {
            0% {
                transform: scale(1);
                text-shadow: none;
            }
            50% {
                transform: scale(1.25);
                text-shadow: 0 0 8px #fff, 0 0 12px #66bb6a;
            }
            100% {
                transform: scale(1);
                text-shadow: none;
            }
        }

        @keyframes heart-thump {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        @keyframes ui-shake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(1.25px, 1.25px); }
            50% { transform: translate(-1.25px, -1.25px); }
            75% { transform: translate(1.25px, -1.25px); }
        }

        .ui-shake-active {
            animation: ui-shake 0.1s linear;
        }

        .stat-updated {
            display: inline-block;
            animation: text-pop-glow 0.4s ease-in-out;
        }

        .heart-lost {
            display: inline-block;
            animation: heart-thump 0.3s ease-in-out;
        }
        
        .pulsating-heart {
            display: inline-block;
            animation: pulsate 1s infinite ease-in-out;
        }

        @keyframes pulsate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        #xpBarContainer {
            width: clamp(60px, 12.5vw, 90px);
            height: 6px;
            background-color: #222;
            border: 1px solid #555;
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
            box-shadow: inset 0 0 3px #000;
        }
        #xpBar {
            height: 100%;
            width: 0%;
            transition: width 0.3s ease-out;
            background: linear-gradient(90deg, #007bff, #00c6ff, #007bff);
            background-size: 200% 100%;
            animation: gradient-flow 3s linear infinite;
        }

        @keyframes gradient-flow {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        
        @media (max-width: 550px) and (max-height: 700px) {
             .thumbstick-base {
                width: 84px;
                height: 84px;
            }
            .thumbstick-cap {
                width: 42px;
                height: 42px;
            }
            #movement-stick-base {
                bottom: 115px;
                left: 56px;
            }
             #fire-stick-base {
                bottom: 115px;
                right: 56px;
            }
        }
        
        @media (max-width: 380px) {
            .thumbstick-base {
                width: 74px;
                height: 74px;
            }
            .thumbstick-cap {
                width: 36px;
                height: 36px;
            }
            #movement-stick-base {
                bottom: 94px;
                left: 44px;
            }
            #fire-stick-base {
                bottom: 94px;
                right: 44px;
            }
        }

        #upgradeMenu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 10vh;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            overflow-y: auto;
        }

        #upgradeMenu h2 {
            font-size: 28px;
            color: #66bb6a;
            margin-bottom: 25px;
            text-shadow: 0 0 10px #66bb6a;
            animation: hue-breathing-green 4s infinite ease-in-out;
        }
        
        #levelUpBox {
            width: 200px;
        }

        @keyframes hue-breathing-green {
            0% { filter: hue-rotate(0deg); text-shadow: 0 0 15px #66bb6a; }
            50% { filter: hue-rotate(45deg); text-shadow: 0 0 25px #aaffaa; }
            100% { filter: hue-rotate(0deg); text-shadow: 0 0 15px #66bb6a; }
        }

        #levelUpBox.animate {
            animation: levitate 3s infinite ease-in-out;
        }

        @keyframes levitate {
            0% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
            100% { transform: translateY(0px) scale(1); }
        }

        .upgrade-options-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 90%;
        }

        .upgrade-card {
            background-color: #3a3a3a;
            border-radius: 10px;
            padding: 20px;
            width: 150px;
            aspect-ratio: 1 / 1;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        .upgrade-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 25px rgba(102, 187, 106, 0.7);
        }

        .upgrade-card:hover h3 {
            animation: text-pop-glow 0.5s ease-in-out;
        }
        
        .upgrade-card .upgrade-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .upgrade-card h3 {
            font-size: 20px;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .upgrade-card p {
            font-size: 14px;
            color: #b0b0b0;
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .upgrade-card button {
            background-color: #66bb6a;
            color: #1a1a1a;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 16px;
        }

        .upgrade-card button:hover {
            background-color: #5cb85c;
            transform: translateY(-2px);
        }

        #gameOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 20px;
        }

        #gameOverlay h2 {
            font-size: 40px;
            color: #ff3b3b;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #ff3b3b;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 0 0 10px #ff3b3b, 0 0 20px #ff3b3b, 0 0 30px #ff3b3b;
            animation: wavyGameOver 2s infinite alternate ease-in-out;
        }
        @keyframes wavyGameOver {
            0% { transform: translateY(0px); text-shadow: 0 0 10px #ff3b3b, 0 0 20px #ff3b3b; }
            50% { transform: translateY(-5px); text-shadow: 0 0 15px #ff3b3b, 0 0 25px #ff3b3b, 0 0 35px #ff3b3b; }
            100% { transform: translateY(0px); text-shadow: 0 0 10px #ff3b3b, 0 0 20px #ff3b3b; }
        }

        #gameOverlay p {
            font-size: 24px;
            margin-bottom: 10px;
        }

        #gameOverlay button {
            background-color: #66bb6a;
            color: #1a1a1a;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s;
        }

        #gameOverlay button:hover {
            background-color: #5cb85c;
            transform: scale(1.05);
        }

        #storytellerOutput {
            margin-top: 20px;
            font-size: 18px;
            color: #ffffff;
            max-width: 80%;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #66bb6a;
            line-height: 1.5;
        }

        #loadingStory {
            margin-top: 20px;
            font-size: 20px;
            color: #66bb6a;
        }

        #difficultyContainer, #mapSelectContainer, #characterSelectContainer {
    display: none; 
    position: relative;
    width: clamp(320px, 95vw, 1125px);
    max-height: 95vh; /* ADD THIS LINE */
    max-width: 1125px;
    aspect-ratio: 1125 / 676;
    overflow: hidden;
    border-radius: 10px;
}

        #difficultyScreen, #mapSelectScreen, #characterSelectScreen {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('sprites/mainmenu.png') no-repeat center center;
            background-size: cover;
            z-index: 3000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 20px;
            box-sizing: border-box;
        }

        #difficultyScreen h1, #mapSelectScreen h1, #characterSelectScreen h1 {
            font-size: 48px;
            color: yellow;
            margin-bottom: 20px; 
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
            font-family: 'Press Start 2P', cursive;
            text-shadow: 0 0 10px yellow, 0 0 20px yellow, 0 0 30px yellow;
            animation: wavyTitle 2s infinite alternate ease-in-out;
        }
        @keyframes wavyTitle {
            0% { transform: translateY(0px); text-shadow: 0 0 10px yellow, 0 0 20px yellow; }
            50% { transform: translateY(-5px); text-shadow: 0 0 15px yellow, 0 0 25px yellow, 0 0 35px yellow; }
            100% { transform: translateY(0px); text-shadow: 0 0 10px yellow, 0 0 20px yellow; }
        }

        #highScoresContainer {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            border: 2px solid #FFC107;
            border-radius: 5px;
            padding: 3px 15px;
            font-family: 'Press Start 2P', cursive;
            color: #ffffff;
            font-size: 12px;
            text-shadow: 1px 1px 2px black;
            text-align: left;
        }

        #highScoresContainer h3 {
            font-size: 14px;
            color: #FFC107;
            margin: 0 0 10px 0;
            text-decoration: underline;
        }

        #highScoresContainer p {
            margin: 4px 0;
            text-align: left;
        }

        /* ====================================================== */
        /* == UNIVERSAL PNG BUTTON STYLES FOR MAIN MENU == */
        /* ====================================================== */

        /* This is the base style for all main menu buttons on all platforms */
        .difficulty-buttons button,
        .bottom-menu-buttons button,
        #mobile-bottom-buttons button {
            /* Resets the button to a blank slate */
            all: unset;
            
            /* Core styling for the PNG image */
            display: inline-block;
            cursor: pointer;
            width: 190px;  /* Default size for desktop */
            height: 60px; /* Default size for desktop */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.2s;
            box-sizing: border-box;
            
            /* Reliable Text Hiding */
            font-size: 0;
            color: transparent;
            text-indent: -9999px;
            overflow: hidden;
        }

        /* Hover effect for all buttons */
        .difficulty-buttons button:hover,
        .bottom-menu-buttons button:hover,
        #mobile-bottom-buttons button:hover {
            transform: scale(1.05);
        }

        /* --- Assigning the specific PNG to each button --- */
        .difficulty-buttons .easy {
            background-image: url('sprites/easy.png');
            border: 4px solid #4CAF50;
        }
        .difficulty-buttons .medium {
            background-image: url('sprites/medium.png');
            border: 4px solid #FFC107;
        }
        .difficulty-buttons .hard {
            background-image: url('sprites/hard.png');
            border: 4px solid #F44336;
        }
        #characterSelectButton {
            background-image: url('sprites/characters.png');
        }
        #howToPlayButton {
            background-image: url('sprites/howtoplay.png');
        }

        /* Desktop and Mobile Bottom Buttons */
        #desktopUpgradesButton, #mobileMenuUpgradesButton {
            background-image: url('sprites/upgrades.png');
        }
        #desktopAchievementsButton, #mobileMenuTrophiesButton {
            background-image: url('sprites/achievements.png');
        }
        #desktopResetButton {
            background-image: url('sprites/reset.png');
        }
        
        /* --- Resizing for Mobile --- */
        @media (max-width: 900px) and (orientation: landscape) {
            .difficulty-buttons button,
            .bottom-menu-buttons button,
            #mobile-bottom-buttons button {
                width: 140px;
                height: 45px;
            }
            .difficulty-buttons .easy,
            .difficulty-buttons .medium,
            .difficulty-buttons .hard {
                border-width: 3px;
            }
        }
        @media (max-width: 600px) { /* Simplified this selector to catch both portrait and landscape on small screens */
            .difficulty-buttons button,
            .bottom-menu-buttons button,
            #mobile-bottom-buttons button {
                width: 150px;
                height: 50px;
            }
            .difficulty-buttons .easy,
            .difficulty-buttons .medium,
            .difficulty-buttons .hard {
                border-width: 3px;
            }
        }

        /* --- Positioning for the button containers --- */
        .difficulty-buttons {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            width: 600px;
            margin: 0 auto;
            z-index: 10;
        }
        .bottom-menu-buttons {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 3001;
        }

        #mobileResetButton {
            display: none;
        }

        .emoji-container {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100px;
            height: 100px;
            top: 65%;
            transform: translateY(-50%);
            z-index: 5;
            animation: jump 1.5s ease-in-out infinite;
        }
        
        @keyframes jump {
            0%, 100% {
                transform: translateY(-50%);
            }
            50% {
                transform: translateY(-80%);
            }
        }

        .left-emoji {
            left: 8%; 
        }

        .right-emoji {
            right: 8%; 
        }

        .spinning-emoji {
            font-size: 125px; 
            display: inline-block;
        }

        @keyframes spinClockwise {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes spinCounterClockwise {
            from { transform: rotate(0deg); }
            to { transform: rotate(-360deg); }
        }

        .left-emoji .spinning-emoji {
            animation: spinClockwise 5s linear infinite;
        }
        .right-emoji .spinning-emoji {
            animation: spinCounterClockwise 5s linear infinite;
        }

        #gameGuideModal, #achievementsModal, #cheatsModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 4000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        #gameGuideModal .content-wrapper, #achievementsModal .content-wrapper, #cheatsModal .content-wrapper {
            background-color: #222;
            color: #e0e0e0;
            padding: 20px;
            border-radius: 10px;
            max-width: 900px;
            width: 90%;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.6);
            text-align: left;
        }
        #achievementsModal .content-wrapper {
             box-shadow: 0 0 25px rgba(255, 193, 7, 0.6);
        }
         #cheatsModal .content-wrapper {
             box-shadow: 0 0 25px rgba(255, 0, 255, 0.6);
        }

        #gameGuideModal h2, #achievementsModal h2, #cheatsModal h2 {
            font-size: 28px;
            color: #66bb6a;
            margin-top: 0;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #66bb6a;
        }
        #achievementsModal h2 {
            color: #FFC107;
            text-shadow: 0 0 10px #FFC107;
        }
         #cheatsModal h2 {
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        #gameGuideModal h3 {
            font-size: 20px;
            color: #e0e0e0;
            margin-top: 15px;
            margin-bottom: 10px;
        }
        #gameGuideModal ul {
            list-style-type: none;
            padding: 0;
            margin-bottom: 15px;
        }
        #gameGuideModal li {
            margin-bottom: 8px;
            font-size: 12px;
            line-height: 1.6;
        }
        
        @media (min-width: 800px) {
            #gameGuideModal .guide-columns {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 25px;
            }
        }


        #gameGuideModal button, #achievementsModal button, #cheatsModal button {
            background-color: #66bb6a;
            color: #1a1a1a;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        #gameGuideModal button:hover, #achievementsModal button:hover, #cheatsModal button:hover {
            background-color: #5cb85c;
            transform: scale(1.05);
        }

        #loadingScreen {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: 5000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            font-family: 'Press Start 2P', cursive;
        }

        #loadingText {
            font-size: 24px;
            color: #66bb6a;
            text-shadow: 0 0 10px #66bb6a;
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        #pauseButton {
            position: absolute; 
            top: 10px;
            right: 180px; 
            font-size: 24px;
            cursor: pointer;
            opacity: 0.5;
            z-index: 1500;
            transition: opacity 0.2s;
            background: url('sprites/uibackground.png') no-repeat center center;
            background-size: 100% 100%;
            padding: 5px 10px;
            border-radius: 5px;
        }
        #pauseButton:hover {
            opacity: 0.8;
        }
        #pauseOverlay {
            display: none;
            position: absolute; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1999; 
            flex-direction: column; 
            justify-content: center;
            align-items: center;
        }
        
        @keyframes fast-breath {
            0% { transform: scale(1); text-shadow: 0 0 15px #ffffff; }
            50% { transform: scale(1.1); text-shadow: 0 0 25px #ffffff; }
            100% { transform: scale(1); text-shadow: 0 0 15px #ffffff; }
        }

        #pauseOverlay h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 5vw;
            color: #ffffff;
            text-shadow: 0 0 15px #ffffff;
            animation: fast-breath 0.5s infinite ease-in-out; 
        }

        .pause-controls {
            margin-top: 20px;
            color: white;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .pause-controls > label {
            font-size: 14px;
            margin-bottom: -10px;
        }
        .pause-controls input[type="range"] {
            width: 200px;
        }
        .pause-controls .pause-button-group {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-top: 10px;
        }
        .pause-controls button {
             background-color: #F44336;
            color: white;
            padding: 12px 18px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 0;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s;
        }
        .pause-controls button:hover {
            background-color: #da190b;
            transform: scale(1.05);
        }
        .pause-controls button#resumeButton {
            background-color: #4CAF50;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
        }
        .pause-controls button#resumeButton:hover {
            background-color: #45a049;
        }

        .toggle-switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 200px; 
        }
        .toggle-switch-container label {
            font-size: 14px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #66bb6a;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #66bb6a;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }


        @keyframes hue-breathing {
            0% { filter: hue-rotate(0deg); text-shadow: 0 0 15px #ffffff; }
            50% { filter: hue-rotate(60deg); text-shadow: 0 0 25px #aaffaa; }
            100% { filter: hue-rotate(0deg); text-shadow: 0 0 15px #ffffff; }
        }

        #splashScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 6000;
            justify-content: center;
            align-items: center;
        }
        #splashLogo {
            width: 80%;
            max-width: 400px;
            animation: splash-animation 3s forwards;
        }
        @keyframes splash-animation {
            0% { opacity: 0; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.05); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0.9); }
        }

        #startScreen {
            display: flex; /* Always display initially */
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: #000;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #startButton {
            background-color: #66bb6a;
            color: #1a1a1a;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
            animation: pulse 1.5s infinite ease-in-out;
        }

        #gameStartOverlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2500;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: 'Press Start 2P', cursive;
            animation: fadeOut 2s forwards;
        }

        #gameStartOverlay h2 {
            font-size: 3vw;
            text-shadow: 0 0 15px #ffffff;
        }

        #gameStartOverlay p {
            font-size: 3vw;
            margin-top: 10px;
            color: #66bb6a;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        #upgradeShop {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 3500;
            flex-direction: column;
            justify-content: flex-start; 
            align-items: center;
            color: white;
            font-family: 'Press Start 2P', cursive;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto; 
        }
        #upgradeShop h2, #upgradeShop h3 {
            font-size: 28px;
            color: #FFD700;
            margin-bottom: 10px;
        }
        #upgradeShop h3 {
            font-size: 22px;
            margin-top: 25px;
            color: #00bcd4;
        }
        #currencyDisplay {
            font-size: 20px;
            margin-bottom: 25px;
        }
        #permanentUpgradesContainer, #unlockablePickupsContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }
        .permanent-upgrade-card {
            background-color: #2a2a2a;
            border: 2px solid #007BFF;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        .permanent-upgrade-card h4 { 
            font-size: 16px;
            color: #e0e0e0;
            margin: 0 0 10px 0;
        }
        .permanent-upgrade-card p {
            font-size: 12px;
            color: #b0b0b0;
            margin: 0 0 15px 0;
            min-height: 40px;
            flex-grow: 1;
        }
        .permanent-upgrade-card .upgrade-level {
            font-size: 14px;
            margin-bottom: 10px;
        }
        .permanent-upgrade-card button {
             background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .permanent-upgrade-card button:hover:not(:disabled) {
            background-color: #45a049;
        }
        .permanent-upgrade-card button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        #backToMenuButton {
            background-color: #F44336;
            margin-top: 20px; 
        }

        #mapTilesContainer, #characterTilesContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
        }

        .map-tile {
            aspect-ratio: 16 / 9;
            border: 3px solid #FFC107;
            border-radius: 10px;
            cursor: pointer;
            background-size: cover; /* Makes the image fill the tile */
            background-position: center; /* Centers the image */
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative; /* Required for the text overlay */
            overflow: hidden; /* Keeps overlay within the rounded corners */
        }

        /* This creates a dark overlay so the text is always readable */
        .map-tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: background-color 0.2s;
        }

        .map-tile:hover::before {
            background-color: rgba(0, 0, 0, 0.3); /* Lighten overlay on hover */
        }

        .map-tile p {
            font-family: 'Press Start 2P', cursive;
            color: white;
            font-size: 18px;
            text-shadow: 2px 2px 4px black;
            position: relative; /* Ensures text is above the overlay */
        }

        #backToDifficultySelectButton, #backToMenuFromCharsButton {
            background-color: #F44336;
            color: white;
            padding: 18px 25px;
            border: none;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
        }
        
        /* --- ACHIEVEMENT & CHEAT STYLES --- */
        #achievementsContainer, #cheatsContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            width: 100%;
        }
        .achievement-card {
            background-color: #333;
            border: 2px solid #555;
            padding: 15px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .achievement-card.unlocked {
            border-color: #FFC107;
            background-color: #4a411c;
        }
        .achievement-icon {
            font-size: 32px;
            flex-shrink: 0;
        }
        .achievement-card.unlocked .achievement-icon {
            filter: none;
        }
        .achievement-card:not(.unlocked) .achievement-icon {
            filter: grayscale(1) brightness(0.5);
        }
        .achievement-details h4 {
            margin: 0 0 5px 0;
            color: #ddd;
            font-size: 14px;
        }
        .achievement-card.unlocked .achievement-details h4 {
            color: #FFC107;
        }
        .achievement-details p {
            margin: 0;
            font-size: 12px;
            color: #999;
        }
        .achievement-card.unlocked .achievement-details p {
            color: #ccc;
        }

        #achievement-banner {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #222;
            border: 2px solid #FFC107;
            border-radius: 10px;
            padding: 15px 25px;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 20px #FFC107;
            transition: bottom 0.5s ease-in-out;
            opacity: 0;
        }
        
        @keyframes banner-in-out {
            0% { bottom: -100px; opacity: 0; }
            10% { bottom: 20px; opacity: 1; }
            90% { bottom: 20px; opacity: 1; }
            100% { bottom: -100px; opacity: 0; }
        }
        #achievement-banner.show {
            animation: banner-in-out 5s forwards;
        }
        
        .cheat-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #2e2230;
            border: 2px solid #888;
            padding: 10px 15px;
            border-radius: 8px;
        }
        .cheat-card.locked {
            filter: grayscale(1) brightness(0.6);
        }
        .cheat-info {
            text-align: left;
        }
         .cheat-info h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
            color: #ff99ff;
        }
         .cheat-info p {
            margin: 0;
            font-size: 11px;
            color: #ccc;
        }

        /* --- NEW MERCHANT STYLES --- */
        #merchantShop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 10vh;
            align-items: center;
            text-align: center;
            box-sizing: border-box;
            overflow-y: auto;
        }

        #merchantShop h2 {
            font-size: 28px;
            color: #FFD700; /* Gold color for merchant */
            margin-bottom: 25px;
            text-shadow: 0 0 10px #FFD700;
        }

        .merchant-options-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            max-width: 90%;
        }

        .merchant-card {
            background-color: #4a411c; /* Dark gold background */
            border-radius: 10px;
            padding: 20px;
            width: clamp(150px, 40vw, 200px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid #FFD700;
        }

        .merchant-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.8);
        }

        .merchant-card .merchant-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .merchant-card h3 {
            font-size: 20px;
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .merchant-card p {
            font-size: 14px;
            color: #b0b0b0;
            margin-bottom: 15px;
            flex-grow: 1;
        }
        
        .merchant-card .cost {
            font-size: 16px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 15px;
        }

        #merchantShop button {
            background-color: #F44336;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.3);
        }


        /* --- MOBILE OPTIMIZATIONS --- */
        #mobile-bottom-buttons {
            display: none; /* Hidden by default */
        }
        
        @media (max-width: 900px) and (orientation: landscape) {
            body.is-mobile {
                min-height: 100vh;
            }

            body.is-mobile #gameContainer {
                width: 100vw;
            }

            body.is-mobile canvas {
                width: 100%;
                height: 100vh;
                object-fit: contain;
                border: none;
                box-shadow: none;
            }
             
            body.is-mobile #gameStats {
                position: absolute;
                top: 10px;
                right: 10px;
                width: auto;
                background: url(sprites/uibackground.png) no-repeat center center;
                background-size: 100% 100%;
                color: #000;
                opacity: 0.5;
                text-align: right;
                padding: 15px 20px;
            }
             body.is-mobile #gameStats p {
                color: #000;
                font-size: 8px;
             }

            body.is-mobile #upgradeMenu {
                padding-top: 2vh;
                justify-content: center;
                overflow-y: hidden;
            }

            body.is-mobile #upgradeMenu h2 {
                font-size: 20px;
                margin-bottom: 10px;
            }

            body.is-mobile #levelUpBox {
                width: 80px;
                margin-bottom: 5px !important;
            }

            body.is-mobile .upgrade-options-container {
        gap: 10px; /* Reduced gap slightly */
        flex-direction: row; /* Keep this as row */
        align-items: center;
        width: 100%;
        justify-content: center; /* Add this to center the cards */
    }

    /* CHANGE THIS RULE */
    body.is-mobile .upgrade-card {
        width: clamp(100px, 28vw, 130px); /* Make cards much narrower */
        padding: 10px; /* Reduce padding */
        aspect-ratio: 1 / 1.2; /* Allow card to be slightly taller than wide */
    }

    /* CHANGE THIS RULE */
    body.is-mobile .upgrade-card h3 {
        font-size: 13px; /* Smaller font for title */
        margin-bottom: 5px;
    }

    /* CHANGE THIS RULE */
    body.is-mobile .upgrade-card p {
        font-size: 10px; /* Smaller font for description */
        margin-bottom: 8px;
    }
            body.is-mobile .upgrade-card button {
                font-size: 12px;
                padding: 6px 10px;
            }

            body.is-mobile #difficultyScreen h1 {
                font-size: 24px;
                margin-bottom: 10px;
            }

            body.is-mobile #highScoresContainer {
                font-size: 8px;
                padding: 5px 10px;
                margin-bottom: 10px;
            }
            body.is-mobile #highScoresContainer h3 {
                font-size: 10px;
                margin-bottom: 5px;
            }

            body.is-mobile .difficulty-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                width: 80%;
                max-width: 320px;
            }

            body.is-mobile #gameOverlay h2 {
                font-size: 24px;
            }
            body.is-mobile #gameOverlay p {
                font-size: 16px;
            }
            body.is-mobile #gameOverlay button {
                font-size: 16px;
                padding: 8px 18px;
            }
            
            body.is-mobile #gameGuideModal .content-wrapper,
            body.is-mobile #achievementsModal .content-wrapper,
            body.is-mobile #cheatsModal .content-wrapper {
                padding: 15px;
                width: 95%;
            }
            body.is-mobile #gameGuideModal h2,
            body.is-mobile #achievementsModal h2,
            body.is-mobile #cheatsModal h2 {
                font-size: 24px;
            }
            body.is-mobile #gameGuideModal h3 {
                font-size: 18px;
            }
            body.is-mobile #gameGuideModal li {
                font-size: 12px;
            }
            body.is-mobile #gameGuideModal button,
            body.is-mobile #achievementsModal button,
            body.is-mobile #cheatsModal button {
                font-size: 18px;
            }

            body.is-mobile #movement-stick-base {
                bottom: 20px;
                left: 20px;
                 width: 120px;
                height: 120px;
            }
            body.is-mobile #fire-stick-base {
                bottom: 20px;
                right: 20px;
                 width: 120px;
                height: 120px;
            }
             body.is-mobile .thumbstick-cap {
                width: 60px;
                height: 60px;
            }
            body.is-mobile .left-emoji {
                left: 5%;
            }
            body.is-mobile .right-emoji {
                right: 5%;
            }
        }
        
        @media (max-width: 600px) {
            #difficultyScreen h1 {
                font-size: 24px;
                margin-bottom: 15px;
            }

            .difficulty-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                width: 90%;
            }

            .spinning-emoji {
                font-size: 60px;
            }

            .emoji-container {
                width: 80px;
                height: 80px;
            }

            .left-emoji {
                left: 1%;
            }

            .right-emoji {
                right: 1%;
            }
        }

@media (max-width: 600px) and (orientation: portrait) {
    body.is-mobile {
        min-height: 100vh;
    }

    body.is-mobile #highScoresContainer {
    display: none;
    }

    /* FIX: Prevents the main menu from stretching vertically */
    body.is-mobile #difficultyContainer {
        width: 100vw;
        /* height: 100vh; <-- This was removed to preserve the aspect ratio */
        border-radius: 0;
    }

    body.is-mobile #difficultyScreen {
        justify-content: space-around;
        padding-bottom: 20px; /* Reduced padding since fixed buttons are gone */
    }

    body.is-mobile #highScoresContainer {
        position: relative;
        top: auto;
        left: auto;
        margin: 10px 0;
        align-self: center;
    }

    body.is-mobile .emoji-container {
        display: none;
    }

    .main-menu-side-buttons {
        display: none;
    }

    /* FIX: Hide the redundant mobile button bar */
    #mobile-bottom-buttons {
        display: none; /* Changed from flex */
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        gap: 15px;
        z-index: 3001;
    }
    
    /* FIX: Make the desktop buttons stack in the normal layout flow */
    .bottom-menu-buttons {
        position: static;
        transform: none;
        margin-top: 10px;
    }

    /* FIX: Make all buttons smaller to fit the screen */
    .difficulty-buttons button,
    .bottom-menu-buttons button {
        width: 120px;
        height: 40px;
    }

    #mobileCheatsButton {
        display: none;
    }

    body.is-mobile .difficulty-buttons button.upgrades {
        display: none;
    }

    body.is-mobile #inGameUIContainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        order: 2;
    }

    body.is-mobile #gameStats {
        position: relative;
        order: 0;
        top: auto; right: auto;
        width: 95%;
        margin: 10px auto 0;
        padding: 8px;
        background: none;
        border: 1px solid #66bb6a;
        color: #e0e0e0;
        opacity: 0.9;
        text-align: center;
    }
    
    body.is-mobile #mobileResetButton {
        display: block;
        order: 1;
        width: 95%;
        max-width: 50px;
        margin-top: 10px;
        margin-bottom: 10px;
        padding: 5px;
        font-family: 'Press Start 2P', cursive;
        font-size: 6px;
        border-radius: 20px;
        border: none;
        color: white;
        cursor: pointer;
        opacity: 0.3;
    }

    body.is-mobile #gameStats p {
        color: #e0e0e0;
        margin: 1px 0;
        font-size: 10px;
    }

    body.is-mobile #powerupIcons,
    body.is-mobile #xpBarContainer {
        justify-content: center;
        margin-left: auto;
        margin-right: auto;
    }

    body.is-mobile #pauseButton {
        top: 10px;
        right: 10px;
    }

    body.is-mobile #gameOverlay h2 {
        font-size: 28px;
    }

    body.is-mobile #gameOverlay p {
        font-size: 18px;
    }

    body.is-mobile #gameOverlay button {
        font-size: 18px;
        padding: 10px 20px;
    }

    body.is-mobile #upgradeMenu {
        padding-top: 8vh;
        justify-content: center;
    }

    body.is-mobile #upgradeMenu h2 {
        font-size: 24px;
        margin-bottom: 15px;
    }

    body.is-mobile #levelUpBox {
        width: 120px;
    }

    body.is-mobile .upgrade-options-container {
        gap: 10px;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        width: 100%;
    }

    body.is-mobile .upgrade-card {
        width: clamp(100px, 28vw, 130px);
        padding: 10px;
        aspect-ratio: 1 / 1.2;
    }

    body.is-mobile .upgrade-card h3 {
        font-size: 13px;
        margin-bottom: 5px;
    }

    body.is-mobile .upgrade-card p {
        font-size: 10px;
        margin-bottom: 8px;
    }
}
